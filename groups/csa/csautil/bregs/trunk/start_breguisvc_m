#!/bin/ksh
# $Id$ $CSID$ $CCId$

BREGUISVC_BIN=`dirname $0`
[[ -n ${BREGUISVC_BIN##/*} ]] && BREGUISVC_BIN=$PWD/${BREGUISVC_BIN#.}

if [[ -a /bb/data/netlocal.dta ]] ; then
    read MYCPUID < /bb/data/netlocal.dta
else
    MYCPUID=`hostname`
fi

instance=""
if bbhost -w ${MYCPUID} "gsrv" >> /dev/null 2>&1 ;then 
    instance="1 2 3 4 5 6 7"
fi

for i in $instance
do
task=breguis$i

BREGUISVC_LOGDN=/bb/data
BREGUISVC_LOGBN=$task.log
BREGUISVC_LOGFILE=$BREGUISVC_LOGDN/$BREGUISVC_LOGBN

openpipe $task
echo "starting task $task" >> /tmp/$task.fifo

# Remove log files older than 4 days
echo "start $task /bb/bin/baellog_cleanup.pl -d $BREGUISVC_LOGDN \
                                             -e $BREGUISVC_LOGBN \
                                             -q 4                \
          >> /tmp/$task.fifo 2>&1"                               \
    >> /tmp/p.fifo

# Start the service
echo "pstart $task $BREGUISVC_BIN/pstart_breguisvc_m $BREGUISVC_BIN $task $BREGUISVC_LOGFILE \
          >> /tmp/$task.fifo 2>&1"                                             \
    >> /tmp/p.fifo

#==================================
# IMPORTANT WARNING: READ CAREFULLY
#==================================
# The following 'send' registers the task with {PWHO SYSCHK<GO>}.  Syschk
# prints errors in act.log if a registered task is not up.  However, since
# syschk is executed at the end of the rstrt script, this particular send
# command will have no effect if run from rstrt.  In this case, you must add
# your task name to /bb/data/syschk.cmd.

send syschk addt $task
done

# GENERATED BY BLP_BAS_CODEGEN_3.5.3 Tue Sep 14 13:44:26 2010
